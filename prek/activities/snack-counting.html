<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Snack Counting - Pre-K Math Activity - Meadow Math">
  <title>Snack Counting - Meadow Math</title>
  
  <!-- CSS Files -->
  <link rel="stylesheet" href="../../css/reset.css">
  <link rel="stylesheet" href="../../css/variables.css">
  <link rel="stylesheet" href="../../css/global.css">
  <link rel="stylesheet" href="../../css/animations.css">
  <link rel="stylesheet" href="../../css/sidebar.css">
  <link rel="stylesheet" href="../../css/navigation.css">
  <link rel="stylesheet" href="activity.css">
</head>
<body>
  <!-- Hamburger Menu (Mobile Only) -->
  <button class="hamburger" aria-label="Toggle navigation menu">
    <div class="hamburger-icon">
      <div class="hamburger-line"></div>
      <div class="hamburger-line"></div>
      <div class="hamburger-line"></div>
    </div>
  </button>

  <!-- Sidebar Backdrop (Mobile Only) -->
  <div class="sidebar-backdrop"></div>

  <!-- Application Container -->
  <div class="app-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <a href="../../index.html" class="sidebar-logo">
        <span class="sidebar-logo-text" data-i18n="siteName">Meadow Math</span>
      </a>

      <nav class="sidebar-nav" aria-label="Main navigation">
        <a href="../../index.html" class="nav-item">
          <span class="nav-item-icon">ğŸ </span>
          <span class="nav-item-text" data-i18n="nav.home">Home</span>
        </a>
        <a href="../index.html" class="nav-item active">
          <span class="nav-item-icon">ğŸªº</span>
          <span class="nav-item-text" data-i18n="nav.prek">Pre-K</span>
        </a>
        <a href="../../kindergarten/index.html" class="nav-item">
          <span class="nav-item-icon">ğŸŒ±</span>
          <span class="nav-item-text" data-i18n="nav.kindergarten">Kinder</span>
        </a>
        <a href="../../grade1/index.html" class="nav-item">
          <span class="nav-item-icon">ğŸ“</span>
          <span class="nav-item-text" data-i18n="nav.grade1">Grade 1</span>
        </a>
        <a href="../../grade2/index.html" class="nav-item">
          <span class="nav-item-icon">â•</span>
          <span class="nav-item-text" data-i18n="nav.grade2">Grade 2</span>
        </a>
        <a href="../../grade3/index.html" class="nav-item">
          <span class="nav-item-icon">â–</span>
          <span class="nav-item-text" data-i18n="nav.grade3">Grade 3</span>
        </a>
        <a href="../../grade4/index.html" class="nav-item">
          <span class="nav-item-icon">âœ–ï¸</span>
          <span class="nav-item-text" data-i18n="nav.grade4">Grade 4</span>
        </a>
        <a href="../../grade5/index.html" class="nav-item">
          <span class="nav-item-icon">â—</span>
          <span class="nav-item-text" data-i18n="nav.grade5">Grade 5</span>
        </a>
      </nav>

      <div class="language-switcher">
        <span class="language-label" data-i18n="language">Language</span>
        <div class="language-buttons">
          <button class="lang-btn active" data-lang="en" aria-label="English">ğŸ‡ºğŸ‡¸</button>
          <button class="lang-btn" data-lang="vi" aria-label="Tiáº¿ng Viá»‡t">ğŸ‡»ğŸ‡³</button>
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <div class="activity-wrapper">
        <!-- Activity Header -->
        <header class="activity-header">
          <a href="../index.html" class="back-link"><span data-i18n="activity.backTo">â† Back to</span> <span data-i18n="nav.prek">Pre-K</span></a>
          <h1 class="activity-title">
            <span class="activity-title-icon">ğŸ‡</span>
            <span data-i18n="section.activities.snack-counting.title">Snack Counting</span>
          </h1>
          <p class="activity-instruction" data-i18n="section.activities.snack-counting.description">Count all the yummy snacks!</p>
        </header>

        <!-- Activity Area -->
        <div class="activity-area">
          <!-- Progress -->
          <div class="progress-indicator" id="progress"></div>

          <!-- Snacks Display -->
          <div class="counting-area" id="snacks-area"></div>

          <!-- Counter -->
          <div class="counter-display">
            <div class="counter-number" id="counter">0</div>
            <div class="counter-label" id="snack-name" data-i18n="activity.snacks">snacks</div>
          </div>

          <!-- Feedback Message -->
          <div class="feedback-message" id="feedback"></div>
        </div>

        <!-- Action Buttons -->
        <div class="activity-actions">
          <button class="btn-activity btn-secondary" id="btn-reset" data-i18n="buttons.reset">Try Again</button>
        </div>
      </div>

      <!-- Stats Overlay -->
      <div class="stats-overlay" id="stats-overlay">
        <div class="stats-modal">
          <div class="stats-icon">ğŸŒŸ</div>
          <h2 class="stats-title" data-i18n="stats.wellDone">Well Done!</h2>
          <p class="stats-message" id="stats-message">You counted all the snacks!</p>
          <div class="stats-actions">
            <button class="btn-activity btn-primary" id="btn-play-again" data-i18n="buttons.playAgain">Play Again</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- JavaScript Files -->
  <script src="../../js/utils.js"></script>
  <script src="../../js/storage.js"></script>
  <script src="../../js/animations.js"></script>
  <script src="../../js/i18n.js"></script>
  <script src="../../js/navigation.js"></script>
  <script>
    // Snack Counting Activity
    const SnackCounting = {
      // Game state
      targetNumber: 0,
      currentCount: 0,
      round: 1,
      maxRounds: 6,
      isComplete: false,
      currentSnack: null,
      autoAdvanceDelay: 1500,

      // DOM elements
      snacksArea: null,
      counter: null,
      feedback: null,
      progress: null,
      snackName: null,
      btnReset: null,
      statsOverlay: null,
      statsMessage: null,
      btnPlayAgain: null,

      // Snack types with names
      snacks: [
        { emoji: 'ğŸ‡', name: 'grapes', plural: 'grapes' },
        { emoji: 'ğŸ', name: 'apple', plural: 'apples' },
        { emoji: 'ğŸª', name: 'cookie', plural: 'cookies' },
        { emoji: 'ğŸ§', name: 'cupcake', plural: 'cupcakes' },
        { emoji: 'ğŸ“', name: 'strawberry', plural: 'strawberries' },
        { emoji: 'ğŸ¥•', name: 'carrot', plural: 'carrots' },
        { emoji: 'ğŸŒ', name: 'banana', plural: 'bananas' },
        { emoji: 'ğŸŠ', name: 'orange', plural: 'oranges' }
      ],

      /**
       * Initialize the activity
       */
      init() {
        // Get DOM elements
        this.snacksArea = document.getElementById('snacks-area');
        this.counter = document.getElementById('counter');
        this.feedback = document.getElementById('feedback');
        this.progress = document.getElementById('progress');
        this.snackName = document.getElementById('snack-name');
        this.btnReset = document.getElementById('btn-reset');
        this.statsOverlay = document.getElementById('stats-overlay');
        this.statsMessage = document.getElementById('stats-message');
        this.btnPlayAgain = document.getElementById('btn-play-again');

        // Set up event listeners
        this.btnReset.addEventListener('click', () => this.reset());
        this.btnPlayAgain.addEventListener('click', () => this.restartActivity());
        this.statsOverlay.addEventListener('click', (e) => { if (e.target === this.statsOverlay) this.restartActivity(); });

        // Listen for language changes
        document.addEventListener('languageChanged', () => {
          this.updateTranslations();
        });

        // Start first round
        this.startRound();
        this.renderProgress();
      },

      /**
       * Update translations when language changes
       */
      updateTranslations() {
        // Update snack name label
        this.snackName.textContent = i18n.t('activity.snacks') || 'snacks';
      },

      /**
       * Start a new round
       */
      startRound() {
        // Generate random target (1-10)
        this.targetNumber = randomInt(1, Math.min(5 + this.round, 10));
        this.currentCount = 0;
        this.isComplete = false;

        // Pick random snack
        this.currentSnack = this.snacks[randomInt(0, this.snacks.length - 1)];

        // Update UI
        this.counter.textContent = '0';
        this.snackName.textContent = this.currentSnack.plural;
        this.feedback.classList.remove('show');

        // Generate snacks
        this.renderSnacks();
        this.renderProgress();
      },

      /**
       * Render snacks for counting
       */
      renderSnacks() {
        // Clear area
        this.snacksArea.innerHTML = '';

        // Shuffle positions slightly for visual interest
        const positions = [];
        for (let i = 0; i < this.targetNumber; i++) {
          positions.push(i);
        }

        // Create snack elements
        positions.forEach((pos, i) => {
          const snack = document.createElement('div');
          snack.className = 'count-object';
          snack.textContent = this.currentSnack.emoji;
          snack.dataset.index = i;
          snack.dataset.counted = 'false';
          snack.style.animationDelay = `${i * 0.1}s`;

          snack.addEventListener('click', () => this.countSnack(snack));

          this.snacksArea.appendChild(snack);
        });
      },

      /**
       * Count a snack
       */
      countSnack(element) {
        if (this.isComplete) return;
        if (element.dataset.counted === 'true') return;

        // Mark as counted
        element.dataset.counted = 'true';
        element.classList.add('counted');
        this.currentCount++;

        // Update counter with animation
        this.counter.textContent = this.currentCount;
        this.counter.classList.add('pop');
        setTimeout(() => this.counter.classList.remove('pop'), 300);

        // Play sound
        if (typeof playSound === 'function') {
          playSound('tap');
        }

        // Check if complete
        if (this.currentCount === this.targetNumber) {
          this.completeRound();
        }
      },

      /**
       * Complete the current round
       */
      completeRound() {
        this.isComplete = true;

        // Show feedback
        const emoji = this.targetNumber >= 5 ? 'ğŸŒŸ' : 'ğŸ‰';
        const yummyMsg = i18n.t('section.activities.snack-counting.yummy') || 'Yummy! You counted {n} snacks!';
        this.feedback.textContent = `${emoji} ${yummyMsg.replace('{n}', this.targetNumber)}`;
        this.feedback.classList.add('show');

        // Create celebration effect
        if (typeof celebrate === 'function') {
          celebrate(this.snacksArea);
        }

        this.renderProgress();

        // Auto-advance after delay
        setTimeout(() => {
          if (this.round < this.maxRounds) {
            this.nextRound();
          } else {
            this.showStats();
          }
        }, this.autoAdvanceDelay);
      },

      /**
       * Show completion stats
       */
      showStats() {
        const completeMsg = i18n.t('section.activities.snack-counting.complete') || 'You counted snacks in all {n} rounds! Great job!';
        this.statsMessage.textContent = completeMsg.replace('{n}', this.maxRounds);
        this.statsOverlay.classList.add('show');
      },

      /**
       * Restart the entire activity
       */
      restartActivity() {
        this.round = 1;
        this.statsOverlay.classList.remove('show');
        this.startRound();
      },

      /**
       * Go to next round
       */
      nextRound() {
        this.round++;
        this.startRound();
      },

      /**
       * Reset current round
       */
      reset() {
        this.currentCount = 0;
        this.isComplete = false;
        this.counter.textContent = '0';
        this.feedback.classList.remove('show');
        this.renderSnacks();
      },

      /**
       * Render progress indicator
       */
      renderProgress() {
        let html = '';
        for (let i = 1; i <= this.maxRounds; i++) {
          let className = 'progress-dot';
          if (i < this.round || (i === this.round && this.isComplete)) {
            className += ' completed';
          } else if (i === this.round) {
            className += ' current';
          }
          html += `<div class="${className}"></div>`;
        }
        this.progress.innerHTML = html;
      }
    };

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      SnackCounting.init();
    });
  </script>
<!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "a210a35ec7c04feabcf2a3fe1cb19bc4"}'></script><!-- End Cloudflare Web Analytics --></body>
</html>
